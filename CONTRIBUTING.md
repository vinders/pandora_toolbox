# Contributing

* [Foreword](#foreword)
* [Reporting Issues](#reporting-issues)
* [Pull Requests](#pull-requests)
* [Development](#development)
    * [Workflow](#workflow)
    * [Commit Guidelines](#commit-guidelines)
    * [Coding Style](#coding-style)

---

## Foreword

Pandora Toolbox contains a simple set of helpers and utilities for the development of video games, emulators and real-time projects. *Efficiency* and *portability* are the main guidelines. I created it to use it as a library for my personal projects and for my portfolio.

Please note that the toolbox is **not** a general framework and shouldn't be used or developed as such. It is intended to be a static library, that provides useful/recurring features and abstractions of system calls. It's only supposed to contain utilities that are truly useful for games/emulation/ai/...

Suggestions, bug fixes and new features are welcome, as long as they respect that philosophy. If you'd like to share some ideas or if you're interested in contributing to the project, don't hesitate to contact me. Please provide as much detail and context as possible.

## Reporting Issues

Bugs are demonstrable problems caused by the code in the repository. Good bug reports are very helpful.
Please only report actual bugs as issues (segfaults, crashes, corrupted data, display issues...).
For suggestions, requests for features, improvements or hardware support, please just contact me without creating an issue.

Guidelines for bug reports:
* Search the existing GitHub issues: make sure it hasn't already been reported.
* Try to reproduce it with the latest version: make sure it hasn't been fixed.
* Isolate the problem: identify a reduced test case to reproduce it.
* Issues should contain the following information: 
    * Library version + bug frequency (*'systematic'*, *'sometimes'*, *'once'*).
    * System on which the error occurred (operating system(s), CPU, GPU).
    * A clear description of the symptoms.
    * The test case to reproduce it.
    * Any useful information (error messages/popups, logs, samples of corrupted data...).
    * If reproduced while debugging: line of code triggering the crash/assertion, call-stack...

## Pull Requests

* Please ask first before working on significant pull requests (new features, refactoring...), to avoid spending time on something that might not fit in the original project.
* Please use the same [coding style](#coding-style) and [commit conventions](#commit-guidelines) as the original project.
* The build status in the README file refers to the original repository. You might want to customize it for your fork (but please don't submit those changes in pull requests).

Guidelines for pull requests:
* The scope should remain focused and shouldn't contain unrelated commits.
* Get the latest changes from the original repository first, to manage potential conflicts before submitting a pull request.
* Ensure that the build is successful on all major systems and compilers.
* Pull requests shouldn't contain temporary/debugging code, nor changes specific to a fork (custom readme, changelog, project files...).

---

## Development

### Workflow

Branches:
* *master* : no direct commit, **only merges** from develop (for each release). For releases, call '_scripts/merge_develop_into_master.sh' to merge *develop* into *master* (and update version and changelog + create a tag).
* *develop*: main development branch, with full continuous integration and code coverage. Small or safe features can be directly committed in *develop*. Complex/risky commits belong in feature branches.
* *feat/...* or *fix/...* (ex: *feat/json_serializer*): branches for new features and fixes, with continuous integration on main systems. Should be merged into *develop* when complete (with param --no-ff).

Generated version and docs:

The *build_version.txt* and *CHANGELOG.md* files are automatically generated by the script '_scripts/update_changelog.sh' (or '_scripts/merge_develop_into_master.sh'), based on the prefixes of commits (see 'Commit guidelines' below).

### Commit Guidelines

All commits should follow one of these guidelines for the message (no additional space between prefix and dash):
> * **prefix**-library_or_module_name: description_of_commit
> * **prefix**-issue_number-library_or_module_name: description_of_commit

| prefix |             usage              |
|--------|--------------------------------|
| *major* | Major changes, important breaking of compatibility, new product line, ... Increases the major version number of the project (ex: 1.#.#) and appears in change log. |
| *feat*  | New feature or subfeature, or additional behavior. Increases the minor version number of the project (ex: #.1.#) and appears in change log. If the same feature is subdivided in multiple commits, use *patch* for the first commits, then *feat* for the last commit (feature delivery). Neglectible changes made later (comments, formatting, ...) can also use *patch*. If a feature needs to be refactored or bug-fixed, use *fix* instead. |
| *fix*   | Bug fix or refactoring of a feature. Increases the fix version number of the project (ex: #.#.1) and appears in change log. |
| *patch* | Small changes that do not really affect the behavior of a feature, or comments or additional tests. No impact on the version number. |
| *infra* | Infrastructure changes: cmake, CI, coverage, scripts, ... No impact on the version number. |

*Library or module name*: library containing the changed code (system, memory, pattern, video, ...), or name of the infrastructure module changed (ci, cwork, libs, scripts, ...).

Examples:
> * **feat**-pattern: iterator/iterable pattern + declaration helpers
> * **fix**-9976-pattern: iterator/iterable: fix missing pointer init
> * **infra**-cwork: improve cmake versioning

---

### Coding Style

#### Naming

* **Types (classes, structures, enums)**: *PascalCase*.
* **Type aliases (using, typedef)**: *PascalCase* (except for types similar to C++ stdlib, such as *'time_point'* in a clock).
* **Functions**: *camelCase* (except when dealing with standard C++ stdlib, for cases such as *'try_lock'* or *'max_size'*).
* **Variables, namespaces**: *camelCase*.
* **Macros**: *CAPITAL_LETTERS*.

#### Code indent

* **Indent**: 2 spaces (no tabulations)
* **Brace style**: stroustrup's K&R style:
```c
    if (condition) {
      doStuff();
    }
    else {
      cancel();
    }
```
* **Preprocessor**: also indent preprocessor commands (after the '#' symbol):
```c
    #ifdef _WINDOWS
    # include <Windows.h>
    # if _MSC_VER > 1924
    #   include <filesystem>
    # endif
    #endif
```

#### Class organization

* **Order**: *public* first, then *protected*, and *private* last. Make the class *final* if it's not meant to be inherited.
* **Naming**: private class member variables & private functions are prefixed with '\_' *(ex: int \_value{ 0 };)*.
* **Constructors**: use *=default* or *=delete* for copy/move constructors and operators if possible. If they must be explicitly defined, then the move constructor/operator must be *noexcept*.

#### Comments

* **Guideline**: always add comment headers for classes to describe their goal. Add comments for functions when they're not obvious or when they're complex.
* **Classes headers**: use Doxygen formatting:
```c
    /// @class ClassName
    /// @brief Short description of the class.
    /// @warning Optional warnings about the behavior of the class.
```
* **Functions headers**: use Doxygen formatting:
```c
    /// @brief Short description of the function.
    /// @param paramName  Optional description of an argument, if it's not obvious.
    /// @returns Optional information about the return type, if it's not obvious.
    /// @warning Optional warnings about the behavior of the function.
```
* **Section comments**: to separate sections of a header or sub-sections of a class, use ```// -- title --```.

#### Macros

* **Guideline**: only use macros for code generators (automatic enum serializers, code multipliers...). Prefer inline functions for anything else.
* **Naming**: use capital letters and prefixes. Public macros are prefixed with '\_P\_', and private macros (for internal usage) are prefixed with '__' *(ex: __FILL_PARAMS)*.
* **Definition**: private macros located in header files \*.h (for internal usage in the header file) are undefined at the end of header file (with *#undef __MACRO_NAME*).

#### Good practices

* **Scoped enums**: always use *enum class* instead of *enum* to declare enumerations.
* **Namespaces**: enclose code with namespaces (project and library name) *(ex: pandora::memory::MyMemClass)*.
* **Pointers**: prefer *std::unique_ptr* or *std::shared_ptr* to raw pointers (*Type\**) in most cases. Only use raw pointers for function arguments (optional params or polymorphism) or for special patterns (optional references).
* **Header-only**: only create header-only classes for templates and simple objects. Use implementation files (\*.cpp) for business logic, complex non-template code, or when including a system API (win32, filesystem...).
* **Warnings**: try to fix warnings when it's possible without too much overhead (and without breaking some functionalities).

---

[Go to TOP](#contributing)
